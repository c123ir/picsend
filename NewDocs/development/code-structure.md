# ساختار کد پروژه PicSend

<div dir="rtl">

این سند ساختار کد پروژه PicSend را به تفصیل توضیح می‌دهد. هدف از این سند، ارائه یک دید کلی از سازمان‌دهی کد و قراردادهای نام‌گذاری است.

## نمای کلی پروژه

پروژه PicSend از سه بخش اصلی تشکیل شده است:

1. **کلاینت (ریشه پروژه)**: سرویس فرانت‌اند مبتنی بر React و TypeScript
2. **سرور اصلی (پوشه `server`)**: سرویس بک‌اند اصلی مبتنی بر Node.js، Express و Sequelize
3. **سرور لاگینگ (پوشه `logger`)**: سرویس جداگانه برای مدیریت لاگ‌ها

ساختار کلی پروژه:

```
picsend/
├── public/                    # فایل‌های استاتیک کلاینت
├── src/                       # کد منبع کلاینت
├── server/                    # سرویس بک‌اند اصلی
│   ├── src/                   # کد منبع بک‌اند
│   └── ...
├── logger/                    # سرویس لاگینگ
│   ├── src/                   # کد منبع لاگر
│   └── ...
├── docs/                      # مستندات
└── ...
```

## ساختار کلاینت (Front-end)

کلاینت با استفاده از React، TypeScript و Vite پیاده‌سازی شده است.

```
src/
├── assets/                    # منابع استاتیک (فونت‌ها، تصاویر و ...)
│   ├── fonts/                 # فونت‌ها (Vazirmatn)
│   └── ...
├── components/                # کامپوننت‌های React
│   ├── auth/                  # کامپوننت‌های مرتبط با احراز هویت
│   ├── common/                # کامپوننت‌های مشترک
│   ├── layout/                # کامپوننت‌های لایه‌بندی
│   └── ...
├── config/                    # فایل‌های پیکربندی
│   ├── api.ts                 # تنظیمات API
│   └── sms.ts                 # تنظیمات سرویس پیامک
├── contexts/                  # Context‌های React
│   ├── AuthContext.tsx        # مدیریت وضعیت احراز هویت
│   └── ThemeContext.tsx       # مدیریت تم
├── lib/                       # کتابخانه‌ها و ابزارها
│   ├── theme/                 # تنظیمات تم
│   └── ...
├── models/                    # تعاریف تایپ‌های TypeScript
│   └── User.ts                # مدل کاربر
├── pages/                     # صفحات برنامه
│   ├── LoginPage.tsx          # صفحه ورود
│   ├── RegisterPage.tsx       # صفحه ثبت‌نام
│   ├── ProfilePage.tsx        # صفحه پروفایل
│   └── ...
├── services/                  # سرویس‌های ارتباط با API
│   ├── api/                   # کلاس‌های دسترسی به API
│   │   ├── authService.ts     # سرویس احراز هویت
│   │   ├── userService.ts     # سرویس کاربران
│   │   └── ...
│   └── smsService.ts          # سرویس ارسال پیامک
├── utils/                     # توابع کمکی
│   ├── logger.ts              # کلاینت لاگینگ
│   ├── loggingClient.ts       # ارتباط با سرویس لاگینگ
│   └── stringUtils.ts         # توابع کمکی برای کار با رشته‌ها
├── App.tsx                    # کامپوننت اصلی برنامه
├── main.tsx                   # نقطه ورود برنامه
└── routes.tsx                 # تعریف مسیرها (react-router)
```

### قراردادهای نام‌گذاری (Front-end)

- **کامپوننت‌ها**: از PascalCase استفاده می‌شود (مثال: `UserProfile.tsx`)
- **هوک‌ها**: با پیشوند `use` شروع می‌شوند (مثال: `useAuth.ts`)
- **کانتکست‌ها**: با پسوند `Context` ختم می‌شوند (مثال: `AuthContext.tsx`)
- **سرویس‌ها**: با پسوند `Service` ختم می‌شوند (مثال: `userService.ts`)
- **صفحات**: با پسوند `Page` ختم می‌شوند (مثال: `LoginPage.tsx`)

## ساختار سرور اصلی (Back-end)

سرور اصلی با استفاده از Node.js، Express، TypeScript و Sequelize پیاده‌سازی شده است.

```
server/
├── dist/                      # کدهای کامپایل شده TypeScript
├── logs/                      # فایل‌های لاگ محلی
├── scripts/                   # اسکریپت‌های کمکی
│   ├── setup-mysql.sh         # اسکریپت راه‌اندازی MySQL
│   └── ...
├── src/                       # کد منبع
│   ├── config/                # تنظیمات
│   │   ├── database.js        # پیکربندی دیتابیس
│   │   └── logger.ts          # پیکربندی لاگر
│   ├── controllers/           # کنترلرهای API
│   │   ├── authController.ts  # کنترلر احراز هویت
│   │   ├── userController.ts  # کنترلر کاربران
│   │   └── ...
│   ├── middleware/            # میدل‌ورهای اکسپرس
│   │   ├── auth.ts            # میدل‌ور احراز هویت
│   │   └── ...
│   ├── models/                # مدل‌های دیتابیس
│   │   ├── User.ts            # مدل کاربر
│   │   └── ...
│   ├── routes/                # مسیرهای API
│   │   ├── authRoutes.ts      # مسیرهای احراز هویت
│   │   ├── userRoutes.ts      # مسیرهای کاربران
│   │   └── ...
│   ├── scripts/               # اسکریپت‌های TypeScript
│   │   └── migrate.ts         # اسکریپت مایگریشن
│   ├── utils/                 # ابزارهای کمکی
│   │   ├── logger.ts          # ابزار لاگینگ
│   │   └── loggingClient.ts   # کلاینت سرویس لاگینگ
│   └── index.ts               # نقطه ورود برنامه
├── .env                       # متغیرهای محیطی
├── package.json               # وابستگی‌ها و اسکریپت‌ها
└── tsconfig.json              # تنظیمات TypeScript
```

### قراردادهای نام‌گذاری (Back-end)

- **کنترلرها**: با پسوند `Controller` ختم می‌شوند (مثال: `userController.ts`)
- **مسیرها**: با پسوند `Routes` ختم می‌شوند (مثال: `userRoutes.ts`)
- **مدل‌ها**: از PascalCase با نام منفرد استفاده می‌شود (مثال: `User.ts`)
- **میدل‌ورها**: از camelCase استفاده می‌شود (مثال: `auth.ts`)

## ساختار سرور لاگینگ (Logger Server)

سرور لاگینگ با استفاده از Node.js، Express، TypeScript و Sequelize پیاده‌سازی شده است.

```
logger/
├── dist/                      # کدهای کامپایل شده TypeScript
├── logs/                      # فایل‌های لاگ
├── scripts/                   # اسکریپت‌های کمکی
│   ├── setup-macos.sh         # اسکریپت راه‌اندازی در macOS
│   └── startup.sh             # اسکریپت راه‌اندازی
├── src/                       # کد منبع
│   ├── public/                # فایل‌های استاتیک
│   │   ├── dashboard.html     # صفحه داشبورد
│   │   └── ...
│   ├── routes/                # مسیرهای API
│   │   ├── dashboard.ts       # مسیرهای داشبورد
│   │   ├── logs.ts            # مسیرهای لاگ
│   │   └── ...
│   ├── index.ts               # نقطه ورود برنامه
│   ├── logging.ts             # کلاس اصلی لاگینگ
│   ├── server.ts              # پیکربندی سرور
│   └── ...
├── test/                      # تست‌ها
├── .env                       # متغیرهای محیطی
├── package.json               # وابستگی‌ها و اسکریپت‌ها
└── tsconfig.json              # تنظیمات TypeScript
```

## رویکردهای برنامه‌نویسی

### ساختار کلی پروژه

1. **معماری Layered**:
   - **لایه نمایش**: کامپوننت‌های React در کلاینت
   - **لایه کنترلر**: کنترلرهای Express در سرور
   - **لایه سرویس**: منطق تجاری در سرور
   - **لایه دسترسی به داده**: مدل‌های Sequelize

2. **الگوهای طراحی**:
   - **MVC**: برای ساختار سرور اصلی
   - **Context API**: برای مدیریت حالت در React
   - **Singleton**: برای اتصال به دیتابیس و لاگینگ
   - **Repository**: برای دسترسی به داده

### استانداردهای کدنویسی

1. **TypeScript**:
   - استفاده از اینترفیس‌ها برای تعریف انواع داده
   - استفاده از type assertion فقط در موارد ضروری
   - تعریف نوع برای تمام توابع و پارامترها

2. **React**:
   - استفاده از کامپوننت‌های تابعی (Function Components)
   - استفاده از React Hooks
   - جداسازی منطق و نمایش

3. **Node.js/Express**:
   - استفاده از async/await برای کنترل جریان‌های ناهمگام
   - استفاده از میدل‌ورها برای عملیات مشترک
   - مدیریت مرکزی خطاها

## جریان داده

1. **ارتباط کلاینت با سرور**:
   - استفاده از API RESTful
   - انتقال داده‌ها با فرمت JSON
   - احراز هویت با JWT

2. **ارتباط سرور با دیتابیس**:
   - استفاده از Sequelize ORM
   - استفاده از ترنزکشن‌ها برای عملیات ACID

3. **ارتباط با سرویس لاگینگ**:
   - ارسال لاگ‌ها با استفاده از HTTP API
   - ذخیره‌سازی دوگانه (دیتابیس و فایل)

## بیشتر بدانید

- [مستندات API](../api/api-docs.md)
- [راه‌اندازی محیط توسعه](./setup.md)
- [کانونشن‌های کدنویسی](./coding-conventions.md)

</div> 
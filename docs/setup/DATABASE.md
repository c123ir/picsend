/* به نام خدای نزدیک */

# مستندات دیتابیس

این فایل شامل ساختار دیتابیس و روابط بین جداول در پروژه PicSend است.

## جداول اصلی

### users
| فیلد | نوع | توضیحات |
| :--- | :--- | :--- |
| `id` | `int` | کلید اصلی |
| `name` | `varchar(255)` | نام کامل کاربر |
| `email` | `varchar(255)` | آدرس ایمیل (یکتا) |
| `password` | `varchar(255)` | رمز عبور (هش شده) |
| `avatar` | `varchar(255)` | مسیر آواتار |
| `role` | `enum` | نقش کاربر (admin/user) |
| `created_at` | `timestamp` | زمان ایجاد |
| `updated_at` | `timestamp` | زمان به‌روزرسانی |

### groups
| فیلد | نوع | توضیحات |
| :--- | :--- | :--- |
| `id` | `int` | کلید اصلی |
| `name` | `varchar(255)` | نام گروه |
| `description` | `text` | توضیحات گروه |
| `created_at` | `timestamp` | زمان ایجاد |
| `updated_at` | `timestamp` | زمان به‌روزرسانی |

### group_members
| فیلد | نوع | توضیحات |
| :--- | :--- | :--- |
| `id` | `int` | کلید اصلی |
| `group_id` | `int` | کلید خارجی به جدول groups |
| `user_id` | `int` | کلید خارجی به جدول users |
| `role` | `varchar(50)` | نقش کاربر در گروه |
| `created_at` | `timestamp` | زمان ایجاد |
| `updated_at` | `timestamp` | زمان به‌روزرسانی |

### requests
| فیلد | نوع | توضیحات |
| :--- | :--- | :--- |
| `id` | `int` | کلید اصلی |
| `title` | `varchar(255)` | عنوان درخواست |
| `description` | `text` | توضیحات درخواست |
| `status` | `enum` | وضعیت (در انتظار تایید/تایید شده/رد شده/در حال بررسی) |
| `group_id` | `int` | کلید خارجی به جدول groups |
| `created_by` | `int` | کلید خارجی به جدول users |
| `created_at` | `timestamp` | زمان ایجاد |
| `updated_at` | `timestamp` | زمان به‌روزرسانی |

### files
| فیلد | نوع | توضیحات |
| :--- | :--- | :--- |
| `id` | `int` | کلید اصلی |
| `name` | `varchar(255)` | نام فایل |
| `type` | `varchar(50)` | نوع فایل |
| `size` | `bigint` | حجم فایل |
| `url` | `varchar(255)` | مسیر فایل |
| `description` | `text` | توضیحات فایل |
| `request_id` | `int` | کلید خارجی به جدول requests |
| `uploaded_by` | `int` | کلید خارجی به جدول users |
| `created_at` | `timestamp` | زمان ایجاد |
| `updated_at` | `timestamp` | زمان به‌روزرسانی |

### tags
| فیلد | نوع | توضیحات |
| :--- | :--- | :--- |
| `id` | `int` | کلید اصلی |
| `name` | `varchar(50)` | نام تگ |
| `color` | `varchar(7)` | رنگ تگ (هگز) |
| `icon` | `varchar(50)` | نام آیکون |
| `created_at` | `timestamp` | زمان ایجاد |
| `updated_at` | `timestamp` | زمان به‌روزرسانی |

### taggables
| فیلد | نوع | توضیحات |
| :--- | :--- | :--- |
| `id` | `int` | کلید اصلی |
| `tag_id` | `int` | کلید خارجی به جدول tags |
| `taggable_id` | `int` | شناسه آیتم تگ شده |
| `taggable_type` | `varchar(50)` | نوع آیتم تگ شده |
| `created_at` | `timestamp` | زمان ایجاد |

## روابط

1. **users - groups**:
   - رابطه چند به چند از طریق جدول `group_members`
   - هر کاربر می‌تواند در چندین گروه عضو باشد
   - هر گروه می‌تواند چندین کاربر داشته باشد

2. **users - requests**:
   - رابطه یک به چند
   - هر کاربر می‌تواند چندین درخواست ایجاد کند
   - هر درخواست فقط یک ایجادکننده دارد

3. **groups - requests**:
   - رابطه یک به چند
   - هر گروه می‌تواند چندین درخواست داشته باشد
   - هر درخواست فقط به یک گروه تعلق دارد

4. **requests - files**:
   - رابطه یک به چند
   - هر درخواست می‌تواند چندین فایل داشته باشد
   - هر فایل فقط به یک درخواست تعلق دارد

5. **tags - (users/groups/requests)**:
   - رابطه چند به چند پلی‌مورفیک از طریق جدول `taggables`
   - هر تگ می‌تواند به چندین آیتم از انواع مختلف اختصاص یابد
   - هر آیتم می‌تواند چندین تگ داشته باشد

## ایندکس‌ها

1. **users**:
   - `email` (یکتا)
   - `role`

2. **groups**:
   - `name`

3. **group_members**:
   - `group_id, user_id` (ترکیبی)
   - `role`

4. **requests**:
   - `group_id`
   - `created_by`
   - `status`

5. **files**:
   - `request_id`
   - `uploaded_by`
   - `type`

6. **tags**:
   - `name` (یکتا)

7. **taggables**:
   - `tag_id, taggable_id, taggable_type` (ترکیبی)

## قوانین یکپارچگی

1. حذف کاربر:
   - درخواست‌های ایجاد شده توسط کاربر حذف نمی‌شوند
   - عضویت کاربر در گروه‌ها حذف می‌شود
   - فایل‌های آپلود شده توسط کاربر حذف نمی‌شوند

2. حذف گروه:
   - تمام درخواست‌های مرتبط با گروه حذف می‌شوند
   - تمام عضویت‌های گروه حذف می‌شوند
   - تمام فایل‌های مرتبط با درخواست‌های گروه حذف می‌شوند

3. حذف درخواست:
   - تمام فایل‌های مرتبط با درخواست حذف می‌شوند
   - تمام تگ‌های مرتبط با درخواست حذف می‌شوند

4. حذف تگ:
   - تمام ارتباطات تگ در جدول `taggables` حذف می‌شوند 